<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The CloudNativePG Contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Installation and upgrades - CloudNativePG v1.28.0-rc2</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/override.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Installation and upgrades";
        var mkdocs_page_input_path = "installation_upgrade.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CloudNativePG v1.28.0-rc2
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">CloudNativePG</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../before_you_start/">Before you start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../use_cases/">Use cases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Installation and upgrades</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#installation-on-kubernetes">Installation on Kubernetes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#directly-using-the-operator-manifest">Directly using the operator manifest</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-the-cnpg-plugin-for-kubectl">Using the cnpg plugin for kubectl</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-the-latest-development-snapshot">Testing the latest development snapshot</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-the-helm-chart">Using the Helm Chart</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#using-olm">Using OLM</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#details-about-the-deployment">Details about the deployment</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#upgrades">Upgrades</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#spread-upgrades">Spread Upgrades</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#in-place-updates-of-the-instance-manager">In-place updates of the instance manager</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#compatibility-among-versions">Compatibility among versions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upgrading-to-127-from-a-previous-minor-version">Upgrading to 1.27 from a previous minor version</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upgrading-to-126-from-a-previous-minor-version">Upgrading to 1.26 from a previous minor version</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#deprecation-of-backup-metrics-and-fields-in-the-cluster-status">Deprecation of backup metrics and fields in the Cluster .status</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#declarative-hibernation-in-the-cnpg-plugin">Declarative Hibernation in the cnpg plugin</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../image_catalog/">Image Catalog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../database_import/">Importing Postgres databases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../instance_manager/">Postgres Instance Manager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../scheduling/">Scheduling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../resource_management/">Resource management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failure_modes/">Failure Modes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rolling_update/">Rolling updates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replication/">Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logical_replication/">Logical Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../wal_archiving/">WAL archiving</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../recovery/">Recovery</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../service_management/">Service management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgresql_conf/">PostgreSQL Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_role_management/">PostgreSQL Role management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_database_management/">PostgreSQL Database management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tablespaces/">Tablespaces</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_conf/">Operator configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cluster_conf/">Instance Pod configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../labels_annotations/">Labels and Annotations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../monitoring/">Monitoring</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../certificates/">Certificates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ssl_connections/">Client TLS/SSL connections</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../applications/">Connecting from an application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection_pooling/">Connection Pooling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replica_cluster/">Replica clusters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes_upgrade/">Kubernetes upgrade and maintenance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgres_upgrades/">PostgreSQL upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubectl-plugin/">Kubectl Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failover/">Automated failover</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fencing/">Fencing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_hibernation/">Declarative hibernation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgis/">PostGIS</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../e2e/">End-to-End Tests</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../container_images/">Container Image Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../imagevolume_extensions/">Image Volume Extensions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cnpg_i/">CNPG-I</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_capability_levels/">Operator capability levels</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../controller/">Custom Pod Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../samples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../networking/">Networking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmarking/">Benchmarking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions (FAQ)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cloudnative-pg.v1/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported_releases/">Supported releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../preview_version/">Preview Versions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CNCF Projects Integrations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/external-secrets/">External Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/cilium/">Cilium</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendixes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_volumesnapshot/">Appendix A - Backup on volume snapshots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_barmanobjectstore/">Appendix B - Backup on object stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/object_stores/">Appendix C - Common object stores for backups</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CloudNativePG v1.28.0-rc2</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Installation and upgrades</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="installation-and-upgrades">Installation and upgrades</h1>
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

<h2 id="installation-on-kubernetes">Installation on Kubernetes</h2>
<h3 id="directly-using-the-operator-manifest">Directly using the operator manifest</h3>
<p>The operator can be installed like any other resource in Kubernetes,
through a YAML manifest applied via <code>kubectl</code>.</p>
<p>You can install the <a href="https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/main/releases/cnpg-1.28.0-rc2.yaml">latest operator manifest</a>
for this minor release as follows:</p>
<pre><code class="language-sh">kubectl apply --server-side -f \
  https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/main/releases/cnpg-1.28.0-rc2.yaml
</code></pre>
<p>You can verify that with:</p>
<pre><code class="language-sh">kubectl rollout status deployment \
  -n cnpg-system cnpg-controller-manager
</code></pre>
<h3 id="using-the-cnpg-plugin-for-kubectl">Using the <code>cnpg</code> plugin for <code>kubectl</code></h3>
<p>You can use the <code>cnpg</code> plugin to override the default configuration options
that are in the static manifests. </p>
<p>For example, to generate the default latest manifest but change the watch
namespaces to only be a specific namespace, you could run:</p>
<pre><code class="language-shell">kubectl cnpg install generate \
  --watch-namespace &quot;specific-namespace&quot; \
  &gt; cnpg_for_specific_namespace.yaml
</code></pre>
<p>Please refer to <a href="../kubectl-plugin/#generation-of-installation-manifests">"<code>cnpg</code> plugin"</a> documentation
for a more comprehensive example. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you are deploying CloudNativePG on GKE and get an error (<code>... failed to
call webhook...</code>), be aware that by default traffic between worker nodes
and control plane is blocked by the firewall except for a few specific
ports, as explained in the official
<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#add_firewall_rules">docs</a>
and by this
<a href="https://github.com/cloudnative-pg/cloudnative-pg/issues/1360">issue</a>.
You'll need to either change the <code>targetPort</code> in the webhook service, to be
one of the allowed ones, or open the webhooks' port (<code>9443</code>) on the
firewall.</p>
</div>
<h3 id="testing-the-latest-development-snapshot">Testing the latest development snapshot</h3>
<p>If you want to test or evaluate the latest development snapshot of
CloudNativePG before the next official patch release, you can download the
manifests from the
<a href="https://github.com/cloudnative-pg/artifacts"><code>cloudnative-pg/artifacts</code></a>
which provides easy access to the current trunk (main) as well as to each
supported release.</p>
<p>For example, you can install the latest snapshot of the operator with:</p>
<pre><code class="language-sh">curl -sSfL \
  https://raw.githubusercontent.com/cloudnative-pg/artifacts/main/manifests/operator-manifest.yaml | \
  kubectl apply --server-side -f -
</code></pre>
<p>If you are instead looking for the latest snapshot of the operator for this
specific minor release, you can just run:</p>
<pre><code class="language-sh">curl -sSfL \
  https://raw.githubusercontent.com/cloudnative-pg/artifacts/release-1.28/manifests/operator-manifest.yaml | \
  kubectl apply --server-side -f -
</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Snapshots are not supported by the CloudNativePG Community, and are not
intended for use in production.</p>
</div>
<h3 id="using-the-helm-chart">Using the Helm Chart</h3>
<p>The operator can be installed using the provided <a href="https://github.com/cloudnative-pg/charts">Helm chart</a>.</p>
<h3 id="using-olm">Using OLM</h3>
<p>CloudNativePG can also be installed via the <a href="https://olm.operatorframework.io/docs/">Operator Lifecycle Manager (OLM)</a>
directly from <a href="https://operatorhub.io/operator/cloudnative-pg">OperatorHub.io</a>.</p>
<p>For deployments on Red Hat OpenShift, EDB offers and fully supports a certified
version of CloudNativePG, available through the
<a href="https://catalog.redhat.com/software/container-stacks/detail/653fd4035eece8598f66d97b">Red Hat OpenShift Container Platform</a>.</p>
<h2 id="details-about-the-deployment">Details about the deployment</h2>
<p>In Kubernetes, the operator is by default installed in the <code>cnpg-system</code>
namespace as a Kubernetes <code>Deployment</code>. The name of this deployment
depends on the installation method.
When installed through the manifest or the <code>cnpg</code> plugin, it is called
<code>cnpg-controller-manager</code> by default. When installed via Helm, the default name
is <code>cnpg-cloudnative-pg</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With Helm you can customize the name of the deployment via the
<code>fullnameOverride</code> field in the <a href="https://helm.sh/docs/chart_template_guide/values_files/"><em>"values.yaml"</em> file</a>.</p>
</div>
<p>You can get more information using the <code>describe</code> command in <code>kubectl</code>:</p>
<pre><code class="language-sh">$ kubectl get deployments -n cnpg-system
NAME                READY   UP-TO-DATE   AVAILABLE   AGE
&lt;deployment-name&gt;   1/1     1            1           18m
</code></pre>
<pre><code class="language-sh">kubectl describe deploy \
  -n cnpg-system \
  &lt;deployment-name&gt;
</code></pre>
<p>As with any Deployment, it sits on top of a ReplicaSet and supports rolling
upgrades. The default configuration of the CloudNativePG operator
comes with a Deployment of a single replica, which is suitable for most
installations. In case the node where the pod is running is not reachable
anymore, the pod will be rescheduled on another node.</p>
<p>If you require high availability at the operator level, it is possible to
specify multiple replicas in the Deployment configuration - given that the
operator supports leader election. Also, you can take advantage of taints and
tolerations to make sure that the operator does not run on the same nodes where
the actual PostgreSQL clusters are running (this might even include the control
plane for self-managed Kubernetes installations).</p>
<div class="admonition seealso">
<p class="admonition-title">Operator configuration</p>
<p>You can change the default behavior of the operator by overriding
some default options. For more information, please refer to the
<a href="../operator_conf/">"Operator configuration"</a> section.</p>
</div>
<h2 id="upgrades">Upgrades</h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please carefully read the <a href="../release_notes/">release notes</a>
before performing an upgrade as some versions might require
extra steps.</p>
</div>
<p>Upgrading CloudNativePG operator is a two-step process:</p>
<ol>
<li>upgrade the controller and the related Kubernetes resources</li>
<li>upgrade the instance manager running in every PostgreSQL pod</li>
</ol>
<p>Unless differently stated in the release notes, the first step is normally done
by applying the manifest of the newer version for plain Kubernetes
installations, or using the native package manager of the used distribution
(please follow the instructions in the above sections).</p>
<p>The second step is automatically triggered after updating the controller. By
default, this initiates a rolling update of every deployed PostgreSQL cluster,
upgrading one instance at a time to use the new instance manager. The rolling
update concludes with a switchover, which is governed by the
<code>primaryUpdateStrategy</code> option. The default value, <code>unsupervised</code>, completes
the switchover automatically. If set to <code>supervised</code>, the user must manually
promote the new primary instance using the <code>cnpg</code> plugin for <code>kubectl</code>.</p>
<div class="admonition seealso">
<p class="admonition-title">Rolling updates</p>
<p>This process is discussed in-depth on the <a href="../rolling_update/">Rolling Updates</a> page.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In case <code>primaryUpdateStrategy</code> is set to the default value of <code>unsupervised</code>,
an upgrade of the operator will trigger a switchover on your PostgreSQL cluster,
causing a (normally negligible) downtime. If your PostgreSQL Cluster has only one
instance, the instance will be automatically restarted as <code>supervised</code> value is
not supported for <code>primaryUpdateStrategy</code>. In either case, your applications will
have to reconnect to PostgreSQL.</p>
</div>
<p>The default rolling update behavior can be replaced with in-place updates of
the instance manager. This approach does not require a restart of the
PostgreSQL instance, thereby avoiding a switchover within the cluster. This
feature, which is disabled by default, is described in detail below.</p>
<h3 id="spread-upgrades">Spread Upgrades</h3>
<p>By default, all PostgreSQL clusters are rolled out simultaneously, which may
lead to a spike in resource usage, especially when managing multiple clusters.
CloudNativePG provides two configuration options at the <a href="../operator_conf/">operator level</a>
that allow you to introduce delays between cluster roll-outs or even between
instances within the same cluster, helping to distribute resource usage over
time:</p>
<ul>
<li><code>CLUSTERS_ROLLOUT_DELAY</code>: Defines the number of seconds to wait between
  roll-outs of different PostgreSQL clusters (default: <code>0</code>).</li>
<li><code>INSTANCES_ROLLOUT_DELAY</code>: Defines the number of seconds to wait between
  roll-outs of individual instances within the same PostgreSQL cluster (default:
  <code>0</code>).</li>
</ul>
<h3 id="in-place-updates-of-the-instance-manager">In-place updates of the instance manager</h3>
<p>By default, CloudNativePG issues a rolling update of the cluster
every time the operator is updated. The new instance manager shipped with the
operator is added to each PostgreSQL pod via an init container.</p>
<p>However, this behavior can be changed via configuration to enable in-place
updates of the instance manager, which is the PID 1 process that keeps the
container alive.</p>
<p>Internally, each instance manager in CloudNativePG supports the injection of a
new executable that replaces the existing one after successfully completing an
integrity verification phase and gracefully terminating all internal processes.
Upon restarting with the new binary, the instance manager seamlessly adopts the
already running <em>postmaster</em>.</p>
<p>As a result, the PostgreSQL process is unaffected by the update, refraining
from the need to perform a switchover. The other side of the coin, is that
the Pod is changed after the start, breaking the pure concept of immutability.</p>
<p>You can enable this feature by setting the <code>ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES</code>
environment variable to <code>'true'</code> in the
<a href="../operator_conf/#available-options">operator configuration</a>.</p>
<p>The in-place upgrade process will not change the init container image inside the
Pods. Therefore, the Pod definition will not reflect the current version of the
operator.</p>
<h3 id="compatibility-among-versions">Compatibility among versions</h3>
<p>CloudNativePG follows semantic versioning. Every release of the
operator within the same API version is compatible with the previous one.
The current API version is v1, corresponding to versions 1.x.y of the operator.</p>
<p>In addition to new features, new versions of the operator contain bug fixes and
stability enhancements. Because of this, <strong>we strongly encourage users to upgrade
to the latest version of the operator</strong>, as each version is released in order to
maintain the most secure and stable Postgres environment.</p>
<p>CloudNativePG currently releases new versions of the operator at
least monthly. If you are unable to apply updates as each version becomes
available, we recommend upgrading through each version in sequential order to
come current periodically and not skipping versions.</p>
<p>The <a href="../release_notes/">release notes</a> page contains a detailed list of the
changes introduced in every released version of CloudNativePG,
and it must be read before upgrading to a newer version of the software.</p>
<p>Most versions are directly upgradable and in that case, applying the newer
manifest for plain Kubernetes installations or using the native package
manager of the chosen distribution is enough.</p>
<p>When versions are not directly upgradable, the old version needs to be
removed before installing the new one. This won't affect user data but
only the operator itself.</p>
<!--
### Upgrading to 1.28.0 or 1.27.x

!!! Important
    We strongly recommend that all CloudNativePG users upgrade to version
    1.28.0, or at least to the latest stable version of your current minor release
    (e.g., 1.27.x).

-->

<h3 id="upgrading-to-127-from-a-previous-minor-version">Upgrading to 1.27 from a previous minor version</h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We strongly recommend that all CloudNativePG users upgrade to version
1.27.0, or at least to the latest stable version of your current minor release
(e.g., 1.26.1).</p>
</div>
<p>Version 1.27 introduces a change in the default behavior of the
<a href="../instance_manager/#liveness-probe">liveness probe</a>: it now enforces the
<a href="../instance_manager/#primary-isolation">shutdown of an isolated primary</a>
within the <code>livenessProbeTimeout</code> (30 seconds).</p>
<p>If this behavior is not suitable for your environment, you can disable the
<em>isolation check</em> in the liveness probe with the following configuration:</p>
<pre><code class="language-yaml">spec:
  probes:
    liveness:
      isolationCheck:
        enabled: false
</code></pre>
<h3 id="upgrading-to-126-from-a-previous-minor-version">Upgrading to 1.26 from a previous minor version</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to changes in the startup probe for the manager component
(<a href="https://github.com/cloudnative-pg/cloudnative-pg/pull/6623">#6623</a>),
upgrading the operator will trigger a restart of your PostgreSQL clusters,
even if in-place updates are enabled (<code>ENABLE_INSTANCE_MANAGER_INPLACE_UPDATES=true</code>).
Your applications will need to reconnect to PostgreSQL after the upgrade.</p>
</div>
<h4 id="deprecation-of-backup-metrics-and-fields-in-the-cluster-status">Deprecation of backup metrics and fields in the <code>Cluster</code> <code>.status</code></h4>
<p>With the transition to a backup and recovery agnostic approach based on CNPG-I
plugins in CloudNativePG, which began with version 1.26.0 for Barman Cloud, we
are starting the deprecation period for the following fields in the <code>.status</code>
section of the <code>Cluster</code> resource:</p>
<ul>
<li><code>firstRecoverabilityPoint</code></li>
<li><code>firstRecoverabilityPointByMethod</code></li>
<li><code>lastSuccessfulBackup</code></li>
<li><code>lastSuccessfulBackupByMethod</code></li>
<li><code>lastFailedBackup</code></li>
</ul>
<p>The following Prometheus metrics are also deprecated:</p>
<ul>
<li><code>cnpg_collector_first_recoverability_point</code></li>
<li><code>cnpg_collector_last_failed_backup_timestamp</code></li>
<li><code>cnpg_collector_last_available_backup_timestamp</code></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you have migrated to a plugin-based backup and recovery solution such as
Barman Cloud, these fields and metrics are no longer synchronized and will
not be updated. Users still relying on the in-core support for Barman Cloud
and volume snapshots can continue to use these fields for the time being.</p>
</div>
<p>Under the new plugin-based approach, multiple backup methods can operate
simultaneously, each with its own timeline for backup and recovery. For
example, some plugins may provide snapshots without WAL archiving, while others
support continuous archiving.</p>
<p>Because of this flexibility, maintaining centralized status fields in the
<code>Cluster</code> resource could be misleading or confusing, as they would not
accurately represent the state across all configured backup methods.
For this reason, these fields are being deprecated.</p>
<p>Instead, each plugin is responsible for exposing its own backup status
information and providing metrics back to the instance manager for monitoring
and operational awareness.</p>
<h4 id="declarative-hibernation-in-the-cnpg-plugin">Declarative Hibernation in the <code>cnpg</code> plugin</h4>
<p>In this release, the <code>cnpg</code> plugin for <code>kubectl</code> transitions from an imperative
to a <a href="../declarative_hibernation/">declarative approach for cluster hibernation</a>.
The <code>hibernate on</code> and <code>hibernate off</code> commands are now convenient shortcuts
that apply declarative changes to enable or disable hibernation.
The <code>hibernate status</code> command has been removed, as its purpose is now
fulfilled by the standard <code>status</code> command.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../architecture/" class="btn btn-neutral float-left" title="Architecture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../quickstart/" class="btn btn-neutral float-right" title="Quickstart">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright Â© CloudNativePG a Series of LF Projects, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../architecture/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
