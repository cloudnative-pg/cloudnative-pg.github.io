<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The CloudNativePG Contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>PostgreSQL Database management - CloudNativePG v1.27</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/override.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "PostgreSQL Database management";
        var mkdocs_page_input_path = "declarative_database_management.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CloudNativePG v1.27
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">CloudNativePG</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../before_you_start/">Before you start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../use_cases/">Use cases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation_upgrade/">Installation and upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../image_catalog/">Image Catalog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../database_import/">Importing Postgres databases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../instance_manager/">Postgres Instance Manager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../scheduling/">Scheduling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../resource_management/">Resource management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failure_modes/">Failure Modes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rolling_update/">Rolling updates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replication/">Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logical_replication/">Logical Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../wal_archiving/">WAL archiving</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../recovery/">Recovery</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../service_management/">Service management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgresql_conf/">PostgreSQL Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_role_management/">PostgreSQL Role management</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">PostgreSQL Database management</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#key-concepts">Key Concepts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#scope-of-management">Scope of Management</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#declarative-database-manifest">Declarative Database Manifest</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#required-fields-in-the-database-manifest">Required Fields in the Database Manifest</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reserved-database-names">Reserved Database Names</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#reconciliation-and-status">Reconciliation and Status</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deleting-a-database">Deleting a Database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#deleting-via-delete-reclaim-policy">Deleting via delete Reclaim Policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#declaratively-setting-ensure-absent">Declaratively Setting ensure: absent</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#managing-extensions-in-a-database">Managing Extensions in a Database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#managing-schemas-in-a-database">Managing Schemas in a Database</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#limitations-and-caveats">Limitations and Caveats</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#renaming-a-database">Renaming a database</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#creating-vs-altering-a-database">Creating vs. Altering a Database</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#replica-clusters">Replica Clusters</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#conflict-resolution">Conflict Resolution</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#postgres-version-differences">Postgres Version Differences</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#manual-changes">Manual Changes</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tablespaces/">Tablespaces</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_conf/">Operator configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cluster_conf/">Instance Pod configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../labels_annotations/">Labels and Annotations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../monitoring/">Monitoring</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../certificates/">Certificates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ssl_connections/">Client TLS/SSL connections</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../applications/">Connecting from an application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection_pooling/">Connection Pooling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replica_cluster/">Replica clusters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes_upgrade/">Kubernetes upgrade and maintenance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgres_upgrades/">PostgreSQL upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubectl-plugin/">Kubectl Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failover/">Automated failover</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fencing/">Fencing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_hibernation/">Declarative hibernation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgis/">PostGIS</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../e2e/">End-to-End Tests</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../container_images/">Container Image Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../imagevolume_extensions/">Image Volume Extensions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cnpg_i/">CNPG-I</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_capability_levels/">Operator capability levels</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../controller/">Custom Pod Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../samples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../networking/">Networking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmarking/">Benchmarking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions (FAQ)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cloudnative-pg.v1/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported_releases/">Supported releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../preview_version/">Preview Versions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CNCF Projects Integrations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/external-secrets/">External Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/cilium/">Cilium</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendixes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_volumesnapshot/">Appendix A - Backup on volume snapshots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_barmanobjectstore/">Appendix B - Backup on object stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/object_stores/">Appendix C - Common object stores for backups</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CloudNativePG v1.27</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">PostgreSQL Database management</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="postgresql-database-management">PostgreSQL Database management</h1>
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

<p>CloudNativePG simplifies PostgreSQL database provisioning by automatically
creating an application database named <code>app</code> by default. This default behavior
is explained in the <a href="../bootstrap/#bootstrap-an-empty-cluster-initdb">"Bootstrap an Empty Cluster"</a>
section.</p>
<p>For more advanced use cases, CloudNativePG introduces <strong>declarative database
management</strong>, which empowers users to define and control the lifecycle of
PostgreSQL databases using the <code>Database</code> Custom Resource Definition (CRD).
This method seamlessly integrates with Kubernetes, providing a scalable,
automated, and consistent approach to managing PostgreSQL databases.</p>
<hr />
<h2 id="key-concepts">Key Concepts</h2>
<h3 id="scope-of-management">Scope of Management</h3>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>CloudNativePG manages <strong>global objects</strong> in PostgreSQL clusters, including
databases, roles, and tablespaces. However, it does <strong>not</strong> manage database content
beyond extensions and schemas (e.g., tables). To manage database content, use specialized
tools or rely on the applications themselves.</p>
</div>
<h3 id="declarative-database-manifest">Declarative <code>Database</code> Manifest</h3>
<p>The following example demonstrates how a <code>Database</code> resource interacts with a
<code>Cluster</code>:</p>
<pre><code class="language-yaml">apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  name: cluster-example-one
spec:
  name: one
  owner: app
  cluster:
    name: cluster-example
  extensions:
  - name: bloom
    ensure: present
</code></pre>
<p>When applied, this manifest creates a <code>Database</code> object called
<code>cluster-example-one</code> requesting a database named <code>one</code>, owned by the <code>app</code>
role, in the <code>cluster-example</code> PostgreSQL cluster.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please refer to the <a href="../cloudnative-pg.v1/#postgresql-cnpg-io-v1-DatabaseSpec">API reference</a>
the full list of attributes you can define for each <code>Database</code> object.</p>
</div>
<h3 id="required-fields-in-the-database-manifest">Required Fields in the <code>Database</code> Manifest</h3>
<ul>
<li><code>metadata.name</code>: Unique name of the Kubernetes object within its namespace.</li>
<li><code>spec.name</code>: Name of the database as it will appear in PostgreSQL.</li>
<li><code>spec.owner</code>: PostgreSQL role that owns the database.</li>
<li><code>spec.cluster.name</code>: Name of the target PostgreSQL cluster.</li>
</ul>
<p>The <code>Database</code> object must reference a specific <code>Cluster</code>, determining where
the database will be created. It is managed by the cluster's primary instance,
ensuring the database is created or updated as needed.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The distinction between <code>metadata.name</code> and <code>spec.name</code> allows multiple
<code>Database</code> resources to reference databases with the same name across different
CloudNativePG clusters in the same Kubernetes namespace.</p>
</div>
<h2 id="reserved-database-names">Reserved Database Names</h2>
<p>PostgreSQL automatically creates databases such as <code>postgres</code>, <code>template0</code>, and
<code>template1</code>. These names are reserved and cannot be used for new <code>Database</code>
objects in CloudNativePG.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Creating a <code>Database</code> with <code>spec.name</code> set to <code>postgres</code>, <code>template0</code>, or
<code>template1</code> is not allowed.</p>
</div>
<h2 id="reconciliation-and-status">Reconciliation and Status</h2>
<p>Once a <code>Database</code> object is reconciled successfully:</p>
<ul>
<li><code>status.applied</code> will be set to <code>true</code>.</li>
<li><code>status.observedGeneration</code> will match the <code>metadata.generation</code> of the last
  applied configuration.</li>
</ul>
<p>Example of a reconciled <code>Database</code> object:</p>
<pre><code class="language-yaml">apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  generation: 1
  name: cluster-example-one
spec:
  cluster:
    name: cluster-example
  name: one
  owner: app
status:
  observedGeneration: 1
  applied: true
</code></pre>
<p>If an error occurs during reconciliation, <code>status.applied</code> will be <code>false</code>, and
an error message will be included in the <code>status.message</code> field.</p>
<h2 id="deleting-a-database">Deleting a Database</h2>
<p>CloudNativePG supports two methods for database deletion:</p>
<ol>
<li>Using the <code>delete</code> reclaim policy</li>
<li>Declaratively setting the database's <code>ensure</code> field to <code>absent</code></li>
</ol>
<h3 id="deleting-via-delete-reclaim-policy">Deleting via <code>delete</code> Reclaim Policy</h3>
<p>The <code>databaseReclaimPolicy</code> field determines the behavior when a <code>Database</code>
object is deleted:</p>
<ul>
<li><code>retain</code> (default): The database remains in PostgreSQL for manual management.</li>
<li><code>delete</code>: The database is automatically removed from PostgreSQL.</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  name: cluster-example-two
spec:
  databaseReclaimPolicy: delete
  name: two
  owner: app
  cluster:
    name: cluster-example
</code></pre>
<p>Deleting this <code>Database</code> object will automatically remove the <code>two</code> database
from the <code>cluster-example</code> cluster.</p>
<h3 id="declaratively-setting-ensure-absent">Declaratively Setting <code>ensure: absent</code></h3>
<p>To remove a database, set the <code>ensure</code> field to <code>absent</code> like in the following
example:.</p>
<pre><code class="language-yaml">apiVersion: postgresql.cnpg.io/v1
kind: Database
metadata:
  name: cluster-example-database-to-drop
spec:
  cluster:
    name: cluster-example
  name: database-to-drop
  owner: app
  ensure: absent
</code></pre>
<p>This manifest ensures that the <code>database-to-drop</code> database is removed from the
<code>cluster-example</code> cluster.</p>
<h2 id="managing-extensions-in-a-database">Managing Extensions in a Database</h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>While extensions are database-scoped rather than global objects,
CloudNativePG provides a declarative interface for managing them. This approach
is necessary because installing certain extensions may require superuser
privileges, which CloudNativePG recommends disabling by default. By leveraging
this API, users can efficiently manage extensions in a scalable and controlled
manner without requiring elevated privileges.</p>
</div>
<p>CloudNativePG simplifies and automates the management of PostgreSQL extensions within the
target database.</p>
<p>To enable this feature, define the <code>spec.extensions</code> field
with a list of extension specifications, as shown in the following example:</p>
<pre><code class="language-yaml"># ...
spec:
  extensions:
  - name: bloom
    ensure: present
# ...
</code></pre>
<p>Each extension entry supports the following properties:</p>
<ul>
<li><code>name</code> <em>(mandatory)</em>: The name of the extension.</li>
<li><code>ensure</code>: Specifies whether the extension should be present or absent in the
  database:<ul>
<li><code>present</code>: Ensures that the extension is installed (default).</li>
<li><code>absent</code>: Ensures that the extension is removed.</li>
</ul>
</li>
<li><code>version</code>: The specific version of the extension to install or
  upgrade to.</li>
<li><code>schema</code>: The schema in which the extension should be installed.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>CloudNativePG manages extensions using the following PostgreSQL’s SQL commands:
<a href="https://www.postgresql.org/docs/current/sql-createextension.html"><code>CREATE EXTENSION</code></a>,
<a href="https://www.postgresql.org/docs/current/sql-dropextension.html"><code>DROP EXTENSION</code></a>,
<a href="https://www.postgresql.org/docs/current/sql-alterextension.html"><code>ALTER EXTENSION</code></a>
(limited to <code>UPDATE TO</code> and <code>SET SCHEMA</code>).</p>
</div>
<p>The operator reconciles only the extensions explicitly listed in
<code>spec.extensions</code>. Any existing extensions not specified in this list remain
unchanged.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before the introduction of declarative extension management, CloudNativePG
did not offer a straightforward way to create extensions through configuration.
To address this, the <a href="../postgresql_conf/#managed-extensions">"managed extensions"</a>
feature was introduced, enabling the automated and transparent management
of key extensions like <code>pg_stat_statements</code>. Currently, it is your
responsibility to ensure there are no conflicts between extension support in
the <code>Database</code> CRD and the managed extensions feature.</p>
</div>
<h2 id="managing-schemas-in-a-database">Managing Schemas in a Database</h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Schema management in PostgreSQL is an exception to CloudNativePG's primary
focus on managing global objects. Since schemas exist within a database, they
are typically managed as part of the application development process. However,
CloudNativePG provides a declarative interface for schema management, primarily
to complete the support of extensions deployment within schemas.</p>
</div>
<p>CloudNativePG simplifies and automates the management of PostgreSQL schemas within the
target database.</p>
<p>To enable this feature, define the <code>spec.schemas</code> field
with a list of schema specifications, as shown in the following example:</p>
<pre><code class="language-yaml"># ...
spec:
  schemas:
  - name: app
    owner: app
# ...
</code></pre>
<p>Each schema entry supports the following properties:</p>
<ul>
<li><code>name</code> <em>(mandatory)</em>: The name of the schema.</li>
<li><code>owner</code>: The owner of the schema.</li>
<li><code>ensure</code>: Specifies whether the schema should be present or absent in the
  database:<ul>
<li><code>present</code>: Ensures that the schema is installed (default).</li>
<li><code>absent</code>: Ensures that the schema is removed.</li>
</ul>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>CloudNativePG manages schemas using the following PostgreSQL’s SQL commands:
<a href="https://www.postgresql.org/docs/current/sql-createschema.html"><code>CREATE SCHEMA</code></a>,
<a href="https://www.postgresql.org/docs/current/sql-dropschema.html"><code>DROP SCHEMA</code></a>,
<a href="https://www.postgresql.org/docs/current/sql-alterschema.html"><code>ALTER SCHEMA</code></a>.</p>
</div>
<h2 id="limitations-and-caveats">Limitations and Caveats</h2>
<h3 id="renaming-a-database">Renaming a database</h3>
<p>While CloudNativePG adheres to PostgreSQL’s
<a href="https://www.postgresql.org/docs/current/sql-createdatabase.html">CREATE DATABASE</a> and
<a href="https://www.postgresql.org/docs/current/sql-alterdatabase.html">ALTER DATABASE</a>
commands, <strong>renaming databases is not supported</strong>.
Attempting to modify <code>spec.name</code> in an existing <code>Database</code> object will result
in rejection by Kubernetes.</p>
<h3 id="creating-vs-altering-a-database">Creating vs. Altering a Database</h3>
<ul>
<li>For new databases, CloudNativePG uses the <code>CREATE DATABASE</code> statement.</li>
<li>For existing databases, <code>ALTER DATABASE</code> is used to apply changes.</li>
</ul>
<p>It is important to note that there are some differences between these two
Postgres commands: in particular, the options accepted by <code>ALTER</code> are a subset
of those accepted by <code>CREATE</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some fields, such as encoding and collation settings, are immutable in
PostgreSQL. Attempts to modify these fields on existing databases will be
ignored.</p>
</div>
<h3 id="replica-clusters">Replica Clusters</h3>
<p>Database objects declared on replica clusters cannot be enforced, as replicas
lack write privileges. These objects will remain in a pending state until the
replica is promoted.</p>
<h3 id="conflict-resolution">Conflict Resolution</h3>
<p>If two <code>Database</code> objects in the same namespace manage the same PostgreSQL
database (i.e., identical <code>spec.name</code> and <code>spec.cluster.name</code>), the second
object will be rejected.</p>
<p>Example status message:</p>
<pre><code class="language-yaml">status:
  applied: false
  message: 'reconciliation error: database &quot;one&quot; is already managed by Database object &quot;cluster-example-one&quot;'
</code></pre>
<h3 id="postgres-version-differences">Postgres Version Differences</h3>
<p>CloudNativePG adheres to PostgreSQL's capabilities. For example, features like
<code>ICU_RULES</code> introduced in PostgreSQL 16 are unavailable in earlier versions.
Errors from PostgreSQL will be reflected in the <code>Database</code> object's <code>status</code>.</p>
<h3 id="manual-changes">Manual Changes</h3>
<p>CloudNativePG does not overwrite manual changes to databases. Once reconciled,
a <code>Database</code> object will not be reapplied unless its <code>metadata.generation</code>
changes, giving flexibility for direct PostgreSQL modifications.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../declarative_role_management/" class="btn btn-neutral float-left" title="PostgreSQL Role management"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tablespaces/" class="btn btn-neutral float-right" title="Tablespaces">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright © CloudNativePG a Series of LF Projects, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../declarative_role_management/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tablespaces/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
