<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The CloudNativePG Contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Service management - CloudNativePG v1.28</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/override.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Service management";
        var mkdocs_page_input_path = "service_management.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CloudNativePG v1.28
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">CloudNativePG</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../before_you_start/">Before you start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../use_cases/">Use cases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation_upgrade/">Installation and upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../image_catalog/">Image Catalog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../database_import/">Importing Postgres databases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../instance_manager/">Postgres Instance Manager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../scheduling/">Scheduling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../resource_management/">Resource management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failure_modes/">Failure Modes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rolling_update/">Rolling updates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replication/">Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logical_replication/">Logical Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../wal_archiving/">WAL archiving</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../recovery/">Recovery</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Service management</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#disabling-default-services">Disabling Default Services</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-your-own-services">Adding Your Own Services</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#about-exposing-postgres-services">About Exposing Postgres Services</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgresql_conf/">PostgreSQL Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_role_management/">PostgreSQL Role management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_database_management/">PostgreSQL Database management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tablespaces/">Tablespaces</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_conf/">Operator configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cluster_conf/">Instance Pod configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../labels_annotations/">Labels and Annotations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../monitoring/">Monitoring</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logging/">Logging</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../certificates/">Certificates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ssl_connections/">Client TLS/SSL connections</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../applications/">Connecting from an application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection_pooling/">Connection Pooling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replica_cluster/">Replica clusters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes_upgrade/">Kubernetes upgrade and maintenance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgres_upgrades/">PostgreSQL upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubectl-plugin/">Kubectl Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failover/">Automated failover</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fencing/">Fencing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_hibernation/">Declarative hibernation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgis/">PostGIS</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../e2e/">End-to-End Tests</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../container_images/">Container Image Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../imagevolume_extensions/">Image Volume Extensions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cnpg_i/">CNPG-I</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_capability_levels/">Operator capability levels</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../controller/">Custom Pod Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../samples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../networking/">Networking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmarking/">Benchmarking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions (FAQ)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cloudnative-pg.v1/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported_releases/">Supported releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../preview_version/">Preview Versions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">CNCF Projects Integrations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/external-secrets/">External Secrets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cncf-projects/cilium/">Cilium</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendixes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_volumesnapshot/">Appendix A - Backup on volume snapshots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/backup_barmanobjectstore/">Appendix B - Backup on object stores</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/object_stores/">Appendix C - Common object stores for backups</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CloudNativePG v1.28</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Service management</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="service-management">Service management</h1>
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

<p>A PostgreSQL cluster should only be accessed via standard Kubernetes network
services directly managed by CloudNativePG. For more details, refer to the
<a href="https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies">"Service" page of the Kubernetes Documentation</a>.</p>
<p>CloudNativePG defines three types of services for each <code>Cluster</code> resource:</p>
<ul>
<li><code>rw</code>: Points to the primary instance of the cluster (read/write).</li>
<li><code>ro</code>: Points to the replicas, where available (read-only).</li>
<li><code>r</code>: Points to any PostgreSQL instance in the cluster (read).</li>
</ul>
<p>By default, CloudNativePG creates all the above services for a <code>Cluster</code>
resource, with the following conventions:</p>
<ul>
<li>The name of the service follows this format: <code>&lt;CLUSTER_NAME&gt;-&lt;SERVICE_NAME&gt;</code>.</li>
<li>All services are of type <code>ClusterIP</code>.</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Default service names are reserved for CloudNativePG usage.</p>
</div>
<p>While this setup covers most use cases for accessing PostgreSQL within the same
Kubernetes cluster, CloudNativePG offers flexibility to:</p>
<ul>
<li>Disable the creation of the <code>ro</code> and/or <code>r</code> default services.</li>
<li>Define your own services using the standard <code>Service</code> API provided by
  Kubernetes.</li>
</ul>
<p>You can mix these two options.</p>
<p>A common scenario arises when using CloudNativePG in database-as-a-service
(DBaaS) contexts, where access to the database from outside the Kubernetes
cluster is required. In such cases, you can create your own service of type
<code>LoadBalancer</code>, if available in your Kubernetes environment.</p>
<h2 id="disabling-default-services">Disabling Default Services</h2>
<p>You can disable any or all of the <code>ro</code> and <code>r</code> default services through the
<a href="../cloudnative-pg.v1/#postgresql-cnpg-io-v1-ManagedServices"><code>managed.services.disabledDefaultServices</code> option</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code>rw</code> service is essential and cannot be disabled because CloudNativePG
relies on it to ensure PostgreSQL replication.</p>
</div>
<p>For example, if you want to remove both the <code>ro</code> (read-only) and <code>r</code> (read)
services, you can use this configuration:</p>
<pre><code class="language-yaml"># &lt;snip&gt;
managed:
  services:
    disabledDefaultServices: [&quot;ro&quot;, &quot;r&quot;]
</code></pre>
<h2 id="adding-your-own-services">Adding Your Own Services</h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When defining your own services, you cannot use any of the default reserved
service names that follow the convention <code>&lt;CLUSTER_NAME&gt;-&lt;SERVICE_NAME&gt;</code>. It is
your responsibility to pick a unique name for the service in the Kubernetes
namespace.</p>
</div>
<p>You can define a list of additional services through the
<a href="../cloudnative-pg.v1/#postgresql-cnpg-io-v1-ManagedService"><code>managed.services.additional</code> stanza</a>
by specifying the service type (e.g., <code>rw</code>) in the <code>selectorType</code> field
and optionally the <code>updateStrategy</code>.</p>
<p>The <code>serviceTemplate</code> field gives you access to the standard Kubernetes API for
the network <code>Service</code> resource, allowing you to define both the <code>metadata</code> and
the <code>spec</code> sections as you like.</p>
<p>You must provide a <code>name</code> to the service and avoid defining the <code>selector</code>
field, as it is managed by the operator.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Service templates give you unlimited possibilities in terms of configuring
network access to your PostgreSQL database. This translates into greater
responsibility on your end to ensure that services work as expected.
CloudNativePG has no control over the service configuration, except honoring
the selector.</p>
</div>
<p>The <code>updateStrategy</code> field allows you to control how the operator
updates a service definition. By default, the operator uses the <code>patch</code>
strategy, applying changes directly to the service.
Alternatively, the <code>replace</code> strategy deletes the existing service and
recreates it from the template.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>replace</code> strategy will cause a service disruption with every
change.  However, it may be necessary for modifying certain
parameters that can only be set during service creation.</p>
</div>
<p>For example, if you want to have a single <code>LoadBalancer</code> service for your
PostgreSQL database primary, you can use the following excerpt:</p>
<pre><code class="language-yaml"># &lt;snip&gt;
managed:
  services:
    additional:
      - selectorType: rw
        serviceTemplate:
          metadata:
            name: &quot;mydb-lb&quot;
            labels:
              test-label: &quot;true&quot;
            annotations:
              test-annotation: &quot;true&quot;
          spec:
            type: LoadBalancer
</code></pre>
<p>The above example also shows how to set metadata such as annotations and labels
for the created service.</p>
<h3 id="about-exposing-postgres-services">About Exposing Postgres Services</h3>
<p>There are primarily three use cases for exposing your PostgreSQL service
outside your Kubernetes cluster:</p>
<ul>
<li>Temporarily, for testing.</li>
<li>Permanently, for <strong>DBaaS purposes</strong>.</li>
<li>Prolonged period/permanently, for <strong>legacy applications</strong> that cannot be
  easily or sustainably containerized and need to reside in a virtual machine
or physical machine outside Kubernetes. This use case is very similar to DBaaS.</li>
</ul>
<p>Be aware that allowing access to a database from the public network could
expose your database to potential attacks from malicious users.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ensure you secure your database before granting external access, or make
sure your Kubernetes cluster is only reachable from a private network.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../recovery/" class="btn btn-neutral float-left" title="Recovery"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../postgresql_conf/" class="btn btn-neutral float-right" title="PostgreSQL Configuration">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright Â© CloudNativePG a Series of LF Projects, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../recovery/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../postgresql_conf/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
