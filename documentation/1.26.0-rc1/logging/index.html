<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The CloudNativePG Contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Logging - CloudNativePG v1.26.0-rc1</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/override.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Logging";
        var mkdocs_page_input_path = "logging.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CloudNativePG v1.26.0-rc1
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">CloudNativePG</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../before_you_start/">Before You Start</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../use_cases/">Use cases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation_upgrade/">Installation and upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../image_catalog/">Image Catalog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bootstrap/">Bootstrap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../database_import/">Importing Postgres databases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../instance_manager/">Postgres instance manager</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../scheduling/">Scheduling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../resource_management/">Resource management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failure_modes/">Failure Modes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../rolling_update/">Rolling Updates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replication/">Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../logical_replication/">Logical Replication</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup/">Backup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup_barmanobjectstore/">Backup on object stores</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../wal_archiving/">WAL archiving</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../backup_volumesnapshot/">Backup on volume snapshots</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../recovery/">Recovery</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../service_management/">Service Management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgresql_conf/">PostgreSQL Configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_role_management/">PostgreSQL Role Management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_database_management/">PostgreSQL Database Management</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tablespaces/">Tablespaces</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_conf/">Operator configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cluster_conf/">Instance pod configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../storage/">Storage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../labels_annotations/">Labels and annotations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../monitoring/">Monitoring</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Logging</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#cluster-logs">Cluster Logs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#operator-logs">Operator Logs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#postgresql-logs">PostgreSQL Logs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#pgaudit-logs">PGAudit Logs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other-logs">Other Logs</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../certificates/">Certificates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ssl_connections/">Client TLS/SSL connections</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../applications/">Connecting from an application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../connection_pooling/">Connection pooling</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replica_cluster/">Replica clusters</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubernetes_upgrade/">Kubernetes Upgrade and Maintenance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgres_upgrades/">PostgreSQL Upgrades</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../kubectl-plugin/">Kubectl Plugin</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../failover/">Automated failover</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../fencing/">Fencing</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../declarative_hibernation/">Declarative hibernation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../postgis/">PostGIS</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../e2e/">End-to-End Tests</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../container_images/">Container Image Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../operator_capability_levels/">Operator capability levels</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../controller/">Custom Pod Controller</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../samples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../networking/">Networking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../benchmarking/">Benchmarking</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../faq/">Frequently Asked Questions (FAQ)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cloudnative-pg.v1/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../supported_releases/">Supported releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../preview_version/">Preview Versions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../release_notes/">Release notes</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Appendixes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../appendixes/object_stores/">Appendix A - Common object stores for backups</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CloudNativePG v1.26.0-rc1</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Logging</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="logging">Logging</h1>
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

<p>CloudNativePG outputs logs in JSON format directly to standard output, including
PostgreSQL logs, without persisting them to storage for security reasons. This
design facilitates seamless integration with most Kubernetes-compatible log
management tools, including command line ones like
<a href="https://github.com/stern/stern">stern</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Long-term storage and management of logs are outside the scope of the
operator and should be handled at the Kubernetes infrastructure level.
For more information, see the
<a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Kubernetes Logging Architecture</a>
documentation.</p>
</div>
<p>Each log entry includes the following fields:</p>
<ul>
<li><code>level</code> – The log level (e.g., <code>info</code>, <code>notice</code>).</li>
<li><code>ts</code> – The timestamp.</li>
<li><code>logger</code> – The type of log (e.g., <code>postgres</code>, <code>pg_controldata</code>).</li>
<li><code>msg</code> – The log message, or the keyword <code>record</code> if the message is in JSON
  format.</li>
<li><code>record</code> – The actual record, with a structure that varies depending on the
  <code>logger</code> type.</li>
<li><code>logging_pod</code> – The name of the pod where the log was generated.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If your log ingestion system requires custom field names, you can rename
the <code>level</code> and <code>ts</code> fields using the <code>log-field-level</code> and
<code>log-field-timestamp</code> flags in the operator controller. This can be configured
by editing the <code>Deployment</code> definition of the <code>cloudnative-pg</code> operator.</p>
</div>
<h2 id="cluster-logs">Cluster Logs</h2>
<p>You can configure the log level for the instance pods in the cluster
specification using the <code>logLevel</code> option. Available log levels are: <code>error</code>,
<code>warning</code>, <code>info</code> (default), <code>debug</code>, and <code>trace</code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Currently, the log level can only be set at the time the instance starts.
Changes to the log level in the cluster specification after the cluster has
started will only apply to new pods, not existing ones.</p>
</div>
<h2 id="operator-logs">Operator Logs</h2>
<p>The logs produced by the operator pod can be configured with log
levels, same as instance pods: <code>error</code>, <code>warning</code>, <code>info</code> (default), <code>debug</code>,
and <code>trace</code>.</p>
<p>The log level for the operator can be configured by editing the <code>Deployment</code>
definition of the operator and setting the <code>--log-level</code> command line argument
to the desired value.</p>
<h2 id="postgresql-logs">PostgreSQL Logs</h2>
<p>Each PostgreSQL log entry is a JSON object with the <code>logger</code> key set to
<code>postgres</code>. The structure of the log entries is as follows:</p>
<pre><code class="language-json">{
  &quot;level&quot;: &quot;info&quot;,
  &quot;ts&quot;: 1619781249.7188137,
  &quot;logger&quot;: &quot;postgres&quot;,
  &quot;msg&quot;: &quot;record&quot;,
  &quot;record&quot;: {
    &quot;log_time&quot;: &quot;2021-04-30 11:14:09.718 UTC&quot;,
    &quot;user_name&quot;: &quot;&quot;,
    &quot;database_name&quot;: &quot;&quot;,
    &quot;process_id&quot;: &quot;25&quot;,
    &quot;connection_from&quot;: &quot;&quot;,
    &quot;session_id&quot;: &quot;608be681.19&quot;,
    &quot;session_line_num&quot;: &quot;1&quot;,
    &quot;command_tag&quot;: &quot;&quot;,
    &quot;session_start_time&quot;: &quot;2021-04-30 11:14:09 UTC&quot;,
    &quot;virtual_transaction_id&quot;: &quot;&quot;,
    &quot;transaction_id&quot;: &quot;0&quot;,
    &quot;error_severity&quot;: &quot;LOG&quot;,
    &quot;sql_state_code&quot;: &quot;00000&quot;,
    &quot;message&quot;: &quot;database system was interrupted; last known up at 2021-04-30 11:14:07 UTC&quot;,
    &quot;detail&quot;: &quot;&quot;,
    &quot;hint&quot;: &quot;&quot;,
    &quot;internal_query&quot;: &quot;&quot;,
    &quot;internal_query_pos&quot;: &quot;&quot;,
    &quot;context&quot;: &quot;&quot;,
    &quot;query&quot;: &quot;&quot;,
    &quot;query_pos&quot;: &quot;&quot;,
    &quot;location&quot;: &quot;&quot;,
    &quot;application_name&quot;: &quot;&quot;,
    &quot;backend_type&quot;: &quot;startup&quot;
  },
  &quot;logging_pod&quot;: &quot;cluster-example-1&quot;,
}
</code></pre>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Internally, the operator uses PostgreSQL's CSV log format. For more details,
refer to the <a href="https://www.postgresql.org/docs/current/runtime-config-logging.html">PostgreSQL documentation on CSV log format</a>.</p>
</div>
<h2 id="pgaudit-logs">PGAudit Logs</h2>
<p>CloudNativePG offers seamless and native support for
<a href="https://www.pgaudit.org/">PGAudit</a> on PostgreSQL clusters.</p>
<p>To enable PGAudit, add the necessary <code>pgaudit</code> parameters in the <code>postgresql</code>
section of the cluster configuration.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The PGAudit library must be added to <code>shared_preload_libraries</code>.
CloudNativePG automatically manages this based on the presence of <code>pgaudit.*</code>
parameters in the PostgreSQL configuration. The operator handles both the
addition and removal of the library from <code>shared_preload_libraries</code>.</p>
</div>
<p>Additionally, the operator manages the creation and removal of the PGAudit
extension across all databases within the cluster.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>CloudNativePG executes the <code>CREATE EXTENSION</code> and <code>DROP EXTENSION</code> commands
in all databases within the cluster that accept connections.</p>
</div>
<p>The following example demonstrates a PostgreSQL <code>Cluster</code> deployment with
PGAudit enabled and configured:</p>
<pre><code class="language-yaml">apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: cluster-example
spec:
  instances: 3

  postgresql:
    parameters:
      &quot;pgaudit.log&quot;: &quot;all, -misc&quot;
      &quot;pgaudit.log_catalog&quot;: &quot;off&quot;
      &quot;pgaudit.log_parameter&quot;: &quot;on&quot;
      &quot;pgaudit.log_relation&quot;: &quot;on&quot;

  storage:
    size: 1Gi
</code></pre>
<p>The audit CSV log entries generated by PGAudit are parsed and routed to
standard output in JSON format, similar to all other logs:</p>
<ul>
<li><code>.logger</code> is set to <code>pgaudit</code>.</li>
<li><code>.msg</code> is set to <code>record</code>.</li>
<li><code>.record</code> contains the entire parsed record as a JSON object. This structure
  resembles that of <code>logging_collector</code> logs, with the exception of
  <code>.record.audit</code>, which contains the PGAudit CSV message formatted as a JSON
  object.</li>
</ul>
<p>This example shows sample log entries:</p>
<pre><code class="language-json">{
  &quot;level&quot;: &quot;info&quot;,
  &quot;ts&quot;: 1627394507.8814096,
  &quot;logger&quot;: &quot;pgaudit&quot;,
  &quot;msg&quot;: &quot;record&quot;,
  &quot;record&quot;: {
    &quot;log_time&quot;: &quot;2021-07-27 14:01:47.881 UTC&quot;,
    &quot;user_name&quot;: &quot;postgres&quot;,
    &quot;database_name&quot;: &quot;postgres&quot;,
    &quot;process_id&quot;: &quot;203&quot;,
    &quot;connection_from&quot;: &quot;[local]&quot;,
    &quot;session_id&quot;: &quot;610011cb.cb&quot;,
    &quot;session_line_num&quot;: &quot;1&quot;,
    &quot;command_tag&quot;: &quot;SELECT&quot;,
    &quot;session_start_time&quot;: &quot;2021-07-27 14:01:47 UTC&quot;,
    &quot;virtual_transaction_id&quot;: &quot;3/336&quot;,
    &quot;transaction_id&quot;: &quot;0&quot;,
    &quot;error_severity&quot;: &quot;LOG&quot;,
    &quot;sql_state_code&quot;: &quot;00000&quot;,
    &quot;backend_type&quot;: &quot;client backend&quot;,
    &quot;audit&quot;: {
      &quot;audit_type&quot;: &quot;SESSION&quot;,
      &quot;statement_id&quot;: &quot;1&quot;,
      &quot;substatement_id&quot;: &quot;1&quot;,
      &quot;class&quot;: &quot;READ&quot;,
      &quot;command&quot;: &quot;SELECT FOR KEY SHARE&quot;,
      &quot;statement&quot;: &quot;SELECT pg_current_wal_lsn()&quot;,
      &quot;parameter&quot;: &quot;&lt;none&gt;&quot;
    }
  },
  &quot;logging_pod&quot;: &quot;cluster-example-1&quot;,
}
</code></pre>
<p>See the
<a href="https://github.com/pgaudit/pgaudit/blob/master/README.md#format">PGAudit documentation</a> <!-- wokeignore:rule=master -->
for more details about each field in a record.</p>
<h2 id="other-logs">Other Logs</h2>
<p>All logs generated by the operator and its instances are in JSON format, with
the <code>logger</code> field indicating the process that produced them. The possible
<code>logger</code> values are as follows:</p>
<ul>
<li><code>barman-cloud-wal-archive</code>: logs from <code>barman-cloud-wal-archive</code></li>
<li><code>barman-cloud-wal-restore</code>: logs from <code>barman-cloud-wal-restore</code></li>
<li><code>initdb</code>: logs from running <code>initdb</code></li>
<li><code>pg_basebackup</code>: logs from running <code>pg_basebackup</code></li>
<li><code>pg_controldata</code>: logs from running <code>pg_controldata</code></li>
<li><code>pg_ctl</code>: logs from running any <code>pg_ctl</code> subcommand</li>
<li><code>pg_rewind</code>: logs from running <code>pg_rewind</code></li>
<li><code>pgaudit</code>: logs from the PGAudit extension</li>
<li><code>postgres</code>: logs from the <code>postgres</code> instance (with <code>msg</code> distinct from
  <code>record</code>)</li>
<li><code>wal-archive</code>: logs from the <code>wal-archive</code> subcommand of the instance manager</li>
<li><code>wal-restore</code>: logs from the <code>wal-restore</code> subcommand of the instance manager</li>
<li><code>instance-manager</code>: from the <a href="../instance_manager/">PostgreSQL instance manager</a></li>
</ul>
<p>With the exception of <code>postgres</code>, which follows a specific structure, all other
<code>logger</code> values contain the <code>msg</code> field with the escaped message that is
logged.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../monitoring/" class="btn btn-neutral float-left" title="Monitoring"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../certificates/" class="btn btn-neutral float-right" title="Certificates">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright © CloudNativePG a Series of LF Projects, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../monitoring/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../certificates/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
